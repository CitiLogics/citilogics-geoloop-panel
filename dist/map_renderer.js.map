{"version":3,"sources":["../src/map_renderer.js"],"names":["link","scope","elem","attrs","ctrl","mapContainer","find","console","log","events","on","render","map","setTimeout","resize","renderingCompleted","newmap","GeoLoop","remove","mapCenterMoved","panToMapCenter","legend","panel","showLegend","createLegend","updateRamp","drawLayerFrames"],"mappings":";;;;;;AAEe,WAASA,IAAT,CAAcC,KAAd,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwC;AACrD,QAAMC,eAAeH,KAAKI,IAAL,CAAU,eAAV,CAArB;AACAC,YAAQC,GAAR,CAAY,0BAAZ;;AAEAJ,SAAKK,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAM;AAC7BC;AACA,UAAIP,KAAKQ,GAAT,EAAc;AACZC,mBAAW,YAAM;AACfT,eAAKQ,GAAL,CAASE,MAAT;AACD,SAFD,EAEG,GAFH;AAGD;AACDV,WAAKW,kBAAL;AACD,KARD;;AAUA,aAASJ,MAAT,GAAkB;AAChBJ,cAAQC,GAAR,CAAY,oBAAZ;AACA,UAAI,CAACJ,KAAKQ,GAAV,EAAe;AACbL,gBAAQC,GAAR,CAAY,qCAAZ;AACA,YAAMQ,SAAS,IAAIC,OAAJ,CAAYb,IAAZ,EAAkBC,aAAa,CAAb,CAAlB,CAAf;AACAD,aAAKQ,GAAL,GAAWR,KAAKQ,GAAL,IAAYI,MAAvB,CAHa,CAGmB;AAChC,YAAIZ,KAAKQ,GAAL,KAAaI,MAAjB,EAAyBA,OAAOE,MAAP,GAJZ,CAI8B;AAC5C;;AAEDd,WAAKQ,GAAL,CAASE,MAAT;;AAEA,UAAIV,KAAKe,cAAT,EAAyBf,KAAKQ,GAAL,CAASQ,cAAT;;AAEzB,UAAI,CAAChB,KAAKQ,GAAL,CAASS,MAAV,IAAoBjB,KAAKkB,KAAL,CAAWC,UAAnC,EAA+CnB,KAAKQ,GAAL,CAASY,YAAT;;AAE/C;AACApB,WAAKqB,UAAL;AACA;AACArB,WAAKQ,GAAL,CAASc,eAAT;AACD;AACF;;qBAlCuB1B,I;;;;AAFjBiB,a","file":"map_renderer.js","sourcesContent":["import GeoLoop from './geoloop';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  const mapContainer = elem.find('.mapcontainer');\n  console.log('initialized map renderer');\n\n  ctrl.events.on('render', () => {\n    render();\n    if (ctrl.map) {\n      setTimeout(() => {\n        ctrl.map.resize();\n      }, 500);\n    }\n    ctrl.renderingCompleted();\n  });\n\n  function render() {\n    console.log('called into RENDER');\n    if (!ctrl.map) {\n      console.log('creating new map (new GeoLoop(...))');\n      const newmap = new GeoLoop(ctrl, mapContainer[0]);\n      ctrl.map = ctrl.map || newmap;  // only update map if there is still nothing (this is as atomic as it gets - small race condition)\n      if (ctrl.map !== newmap) newmap.remove();  // unload new map, if there was one create before\n    }\n\n    ctrl.map.resize();\n\n    if (ctrl.mapCenterMoved) ctrl.map.panToMapCenter();\n\n    if (!ctrl.map.legend && ctrl.panel.showLegend) ctrl.map.createLegend();\n\n    // initialize color ramp/interpolation\n    ctrl.updateRamp();\n    // create frames on map and start the animation\n    ctrl.map.drawLayerFrames();\n  }\n}\n"]}